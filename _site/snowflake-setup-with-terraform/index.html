<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png"
><link rel="shortcut icon" href="/assets/images/favicon.ico" />

<title>My Snowflake Set up with Terraform | JayGrossman.com</title>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>My Snowflake Set up with Terraform | JayGrossman.com</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="My Snowflake Set up with Terraform" />
<meta name="author" content="jay" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My Snowflake Set up with Terraform" />
<meta property="og:description" content="My Snowflake Set up with Terraform" />
<link rel="canonical" href="http://localhost:4000/snowflake-setup-with-terraform/" />
<meta property="og:url" content="http://localhost:4000/snowflake-setup-with-terraform/" />
<meta property="og:site_name" content="JayGrossman.com" />
<meta property="og:image" content="http://localhost:4000/assets/images/headers/snowflake_terraform.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-01-28T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/headers/snowflake_terraform.png" />
<meta property="twitter:title" content="My Snowflake Set up with Terraform" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jay"},"dateModified":"2023-01-28T00:00:00-05:00","datePublished":"2023-01-28T00:00:00-05:00","description":"My Snowflake Set up with Terraform","headline":"My Snowflake Set up with Terraform","image":"http://localhost:4000/assets/images/headers/snowflake_terraform.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/snowflake-setup-with-terraform/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"jay"},"url":"http://localhost:4000/snowflake-setup-with-terraform/"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <!--<a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="JayGrossman.com">
    </a>-->
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="/about/#projects">Projects</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/favorites">Favorite Posts</a>
                    </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle"><a href="/" style="color: #000000;">JayGrossman.com</a></h1>
    <p class="lead">
        Sharing My Fun with Software, Data, Sports, & Collecting!
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=My Snowflake Set up with Terraform&url=http://localhost:4000/snowflake-setup-with-terraform/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/snowflake-setup-with-terraform/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/snowflake-setup-with-terraform/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/jay_headshot.png" alt="Jay Grossman">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a class="link-dark" href="/about">Jay Grossman</a><br>
                       
                        Published on: 
                <span class="post-date"><time class="post-date" datetime="2023-01-28">28 Jan 2023</time></span>           
                <br>
                <ul class="tags" style="margin:0px;">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#data-engineering">#data engineering</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#snowflake">#snowflake</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#terraform">#terraform</a>
                    </li>
                    
                </ul>
            
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">My Snowflake Set up with Terraform</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/headers/snowflake_terraform.png" alt="My Snowflake Set up with Terraform">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <p>I have been working with <a href="https://www.snowflake.com/en/" target="_blank">Snowflake</a> since 2016 when I proposed and chose to bring it into Rent the Runway to replace our very painful on premise Vertica implementation (yes we had it in a data center in NJ). Since then, Snowflake has grown considerably and is now one of the leading Data Warehouse offerings.<br /><br />After implementing data warehouses at several companies and having lots of conversations with some very smart folks, I've learned some things along the way. I've found it is a really good idea to think about up front how I want to segment responsibilities and permissions for databases. I want to decide what types of data to store in different places and to build roles + permission grants to enforce those decisions.&nbsp;</p>
<h3>My Best Practices Assumptions for segmenting data:</h3>
<p>Best practice for running a cloud data warehouse is to build separate repositories for:</p>
<ol>
<li>raw data from source systems and providers</li>
<li>schemas where data is regularly transformed/generated and documented to be consumed for reporting and analysis</li>
<li>area to data exploration, modeling, and experimentation</li>
</ol>
<p>To ensure that these logical areas are used for their defined purposes, we can create specific roles and permissions for each.&nbsp;</p>
<h3>Logical set up of Databases with Role Permissions</h3>

<p><img src="/assets/images/sf_terrafrom_1.png" alt="" /></p>
<p>&nbsp;</p>
<table style="width: 600px;" border="1" cellpadding="5">
<tbody>
<tr>
<td style="padding: 5px; vertical-align: top;"><strong>database</strong></td>
<td style="padding: 5px; vertical-align: top;"><strong>functional description</strong></td>
<td style="padding: 5px; vertical-align: top;"><strong>privileges</strong></td>
</tr>
<tr>
<td style="padding: 5px; vertical-align: top;">Raw</td>
<td style="padding: 5px; vertical-align: top;">
<ul>
<li>Data is loaded from source systems and providers in its original (non transformed) format</li>
<li>No users can directly query this data</li>
</ul>
</td>
<td style="padding: 5px; vertical-align: top;">
<ul>
<li>load_role - full access&nbsp;</li>
<li>transform_role - read</li>
</ul>
</td>
</tr>
<tr>
<td style="padding: 5px; vertical-align: top;">Analytics</td>
<td style="padding: 5px; vertical-align: top;">
<ul>
<li>Data is transformed or generated (on a regular cadence) and documented to support reporting and analysis needs.</li>
<li>Users can directly query this data, but can not write/update</li>
<li>Metabase (and other reporting tools) would read from this database</li>
</ul>
</td>
<td style="padding: 5px; vertical-align: top;">
<ul>
<li>transform_role - full access</li>
<li>report_role - read</li>
</ul>
</td>
</tr>
<tr>
<td style="padding: 5px; vertical-align: top;">Work</td>
<td style="padding: 5px; vertical-align: top;">
<ul>
<li>Serves as an area to data exploration, modeling, and experimentation</li>
<li>Users can access, create/load, and change data in this area</li>
</ul>
</td>
<td style="padding: 5px; vertical-align: top;">
<ul>
<li>analyst_role - full access&nbsp;</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>Other key assumptions with this set up:</p>
<ol>
<li>Each Snowflake Role has its own dedicated compute (Snowflake Warehouse). <br />For instance the LOAD_ROLE can only run on a warehouse named LOAD_WH.<br /><br /></li>
<li>The Raw database should contain a schema for each source system.&nbsp;<br />For example, if we are syncing data from our ecommerce site with a Mongo backend, we would name the schema as MONGO_ECOMMERCE.&nbsp;<br /><br /></li>
<li>In the Analytics database, we define 5 schemas:<br />- <strong>src</strong>:&nbsp; holding dbt models of data that has been lightly transformed from the original source data. Here we may flatten nested variant data into a relational model.<br />- <strong>trans</strong>:&nbsp;schema for intermediate dbt models <br />- <strong>rpt</strong>: holding dbt dimensional models that drive our BI reporting<br />- <strong>export</strong>: holding tables/views that are for data to be exported to systems outside of Snowflake <br />-&nbsp;<strong>db_stats</strong>: metadata about our dbt models like total runtime, last runtime, number of rows added incrementally, etc</li>
<li>The specific tools in the diagram above are meant to be examples for certain roles:<br />- Fivetran to sync raw data from source systems into RAW (could be meltano, airbyte)<br />- dbt to create models in ANALYTICS (could be ML scripts via dagster/airflow)<br />- Metabase to read from ANALYTICS for BI (could be Looker, Tableau, Superset)<br /><br /></li>
<li>You need to consider the processes for Development and Testing of Pipelines + Models. This diagram does not describe how I would approach these topics.</li>
</ol>
<h3>Snowflake configuration management with Terraform</h3>
<p><a href="https://www.terraform.io/" target="_blank">Terraform</a> (created by Hashicorp) is an open-source infrastructure as code software tool that enables you to safely and predictably create, change, and improve infrastructure.</p>
<h3>Chan Zuckerberg terraform provider for Snowflake</h3>
<p>This is a terraform provider plugin for managing Snowflake accounts: <br />GitHub -&nbsp;<a href="https://github.com/Snowflake-Labs/terraform-provider-snowflake" target="_blank">https://github.com/Snowflake-Labs/terraform-provider-snowflake</a></p>
<p>Documentation available here: <br /><a href="https://registry.terraform.io/providers/chanzuckerberg/snowflake/latest/docs" target="_blank">Terraform Registry</a></p>
<p>We can use this framework to manage objects in snowflake such as:</p>
<ul>
<li>databases</li>
<li>roles</li>
<li>schemas</li>
<li>user accounts</li>
<li>permission grants</li>
</ul>
<h3>Github repo with my terraform configuration for this set up</h3>
<p><a href="https://github.com/jaygrossman/snowflake_terraform_setup" target="_blank">https://github.com/jaygrossman/snowflake_terraform_setup</a>&nbsp;&nbsp;</p>
<p>PLEASE NOTE: This scope for this repo does not include the terrafom configuration to set up snowflake stages, functions, and file formatters. These objects often have more dependencies and require more advanced configuration, so I may plan to dedicate future blog posts to explaining the details.&nbsp;</p>
<h3>Folks who this would not have been possible without:</h3>
<table>
<tbody>
<tr>
<td><img src="/assets/images/collin.jpg" alt="" width="200" /></td>
<td><img src="/assets/images/rob.jpg" alt="" width="200" /></td>
<td><img src="/assets/images/tim.jpg" alt="" width="200" /></td>
</tr>
<tr>
<td><a href="https://www.linkedin.com/in/collinmeyers/" target="_blank">Collin Meyers</a></td>
<td><a href="https://www.linkedin.com/in/rob-sokolowski-35b25318/" target="_blank">Rob Sokolowski</a></td>
<td><a href="https://www.linkedin.com/in/timricablanca/" target="_blank">Tim Ricablanca</a></td>
</tr>
</tbody>
</table>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2023-01-28">28 Jan 2023</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <!--<div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                </ul>
            </div>-->
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#data-engineering">#data engineering</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#snowflake">#snowflake</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#terraform">#terraform</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="/fun-first-project-with-my-3d-printer/" > &laquo; Fun First Project with my 3D Printer</a>



            
            
            <a class="next d-block col-md-6 text-lg-right" href="/dagster-fun/">Dagster with Python, Singer, and Meltano &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


    
</div>

-<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Popular Tags <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#sportscarddatabase">SportsCardDatabase  (4)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#analysis">analysis  (9)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#data">data  (3)</a>
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#data-engineering">data engineering  (7)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#dreams">dreams  (3)</a>
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#ebay">eBay  (3)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#favorites">favorites  (7)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#python">python  (4)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#singer">singer  (3)</a>
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#snowflake">snowflake  (4)</a>
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#sportscollectors">sportscollectors  (5)</a>
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#strategy">strategy  (3)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
		</div>
	</div>
</div>


<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 JayGrossman.com 
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//.disqus.com/count.js"></script>


</body>
</html>
