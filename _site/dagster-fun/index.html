<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png"
><link rel="shortcut icon" href="/assets/images/favicon.ico" />

<title>Dagster with Python, Singer, and Meltano | JayGrossman.com</title>

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Dagster with Python, Singer, and Meltano | JayGrossman.com</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Dagster with Python, Singer, and Meltano" />
<meta name="author" content="jay" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Dagster with Python, Singer, and Meltano" />
<meta property="og:description" content="Dagster with Python, Singer, and Meltano" />
<link rel="canonical" href="http://localhost:4000/dagster-fun/" />
<meta property="og:url" content="http://localhost:4000/dagster-fun/" />
<meta property="og:site_name" content="JayGrossman.com" />
<meta property="og:image" content="http://localhost:4000/assets/images/headers/dagster_meltano.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-04T00:00:00-04:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/headers/dagster_meltano.jpg" />
<meta property="twitter:title" content="Dagster with Python, Singer, and Meltano" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"jay"},"dateModified":"2023-04-04T00:00:00-04:00","datePublished":"2023-04-04T00:00:00-04:00","description":"Dagster with Python, Singer, and Meltano","headline":"Dagster with Python, Singer, and Meltano","image":"http://localhost:4000/assets/images/headers/dagster_meltano.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/dagster-fun/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"jay"},"url":"http://localhost:4000/dagster-fun/"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <!--<a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="JayGrossman.com">
    </a>-->
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="/about/#projects">Projects</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/favorites">Favorite Posts</a>
                    </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle"><a href="/" style="color: #000000;">JayGrossman.com</a></h1>
    <p class="lead">
        Sharing My Fun with Software, Data, Sports, & Collecting!
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Dagster with Python, Singer, and Meltano&url=http://localhost:4000/dagster-fun/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/dagster-fun/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/dagster-fun/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/jay_headshot.png" alt="Jay Grossman">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a class="link-dark" href="/about">Jay Grossman</a><br>
                       
                        Published on: 
                <span class="post-date"><time class="post-date" datetime="2023-04-04">04 Apr 2023</time></span>           
                <br>
                <ul class="tags" style="margin:0px;">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#dagster">#dagster</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#data-engineering">#data engineering</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#meltano">#meltano</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#orchestration">#orchestration</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#python">#python</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#singer">#singer</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#workflow">#workflow</a>
                    </li>
                    
                </ul>
            
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Dagster with Python, Singer, and Meltano</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/headers/dagster_meltano.jpg" alt="Dagster with Python, Singer, and Meltano">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <p>I have been a fan of Dagster for data orchestration for a little while and wanted to share some of the basics. There are a lot of cool things I like about it (compared to airflow and other schedulers):</p>
<ul>
<li>It is Declarative (via their <a href="https://docs.dagster.io/concepts/assets/software-defined-assets" target="_blank">Software-Defined Asset</a> object). I personally like tools and frameworks that allow me to declare a desired end state (Terraform, dbt, Puppet, Ansible, etc.) vs. frameworks that have me build a bunch of imperative tasks that get daisy chained together.&nbsp; &nbsp;<br /><br /></li>
<li>It makes it very easy to define dependencies as function arguments. It reminds a lot of simplicity I see with <em>ref()</em> statements in dbt.<br /><br /></li>
<li>It feels like it is a better fit for iterative engineering. It has easy support for <a href="https://docs.dagster.io/guides/dagster/testing-assets" target="_blank">writing unit tests</a> and running the same code/functionality in different environments.<br /><br /></li>
<li>It pretty easily has integration support with many data related steps I would want to apply as part of an asset building pipeline - including tools like dbt<em>,&nbsp;</em>airbye, meltano, etc.</li>
</ul>
<h3>Goal for this blog post:</h3>
<p>In this post, I am going to document different ways how I can build pretty simple common pipelines that take a csv and upload the contents to postgres via Dagster using:</p>
<ol>
<li>Python Code</li>
<li>Singer</li>
<li>Meltano</li>
</ol>
<h3>Set Up Steps for this demo:</h3>
<ol>
<li>We need to install Dasgter + necessary python packages (I am installing it locally, but we could install it in a docker also):<br /><br />&nbsp; &nbsp; &nbsp; pip3 install dagster dagit pandas psycopg2<br /><br /></li>
<li>We need to install postgres (also adding pgadmin for web based admin) in dockers:<br /><br /><a href="https://towardsdatascience.com/how-to-run-postgresql-and-pgadmin-using-docker-3a6a8ae918b5" target="_blank">https://towardsdatascience.com/how-to-run-postgresql-and-pgadmin-using-docker-3a6a8ae918b5<br /><br /></a>This creates us a local postgres instance with a database "demo_db".<br /><br /></li>
<li>We need to create a table in the demo_db database:<br /><br />
<pre class="brush: sql;">CREATE TABLE IF NOT EXISTS public.sales
(
&nbsp; &nbsp; TransactionID text
&nbsp; &nbsp; , Seller text
&nbsp; &nbsp; , Date text
&nbsp; &nbsp; , Value text
&nbsp; &nbsp; , Title text
&nbsp; &nbsp; , Identifier text
&nbsp; &nbsp; , Condition text
&nbsp; &nbsp; , RetailValue text
&nbsp; &nbsp; , ItemValue text
);</pre>


</li>
<li>We need some sample data in csv format to upload, so I cerated some sales data for a 1973 Topps Rich Gossage baseball card (below contains a few records):<br /><br /> TransactionID,Seller,Date,Value,Title,Identifier,Condition,RetailValue,ItemValue <br />8094231,comicards990,2023-04-12,14.59,1973 Topps Rich "Goose" Gossage Rookie White Sox HOF #174,134520441986,Ungraded,6.00,8.73 <br />8094232,916lukey31,2023-04-11,10.95,1973 Topps #174 Rich Gossage RC HOF Vg-Ex *Free Shipping*,275699466365,Ungraded,6.00,8.73 <br />8094233,jayjay5119,2023-04-11,6.50,1973 Topps Baseball! Rich Gossage rookie card! Card174! Chicago White Sox!,195695255305,Ungraded,6.00,8.73</li>
</ol>
<h3>Running Dagster with Python</h3>
<p>1) The first thing I did was to run the scaffolding command to create a new dagster project:</p>
<p style="padding-left: 30px;">dagster project scaffold --name dagster-project</p>
<p>It created the following directory and files:</p>
<table class="table" style="border-width: 0px; border-style: solid; border-color: inherit; border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; text-indent: 0px; border-collapse: collapse; width: 720px; table-layout: auto; margin-top: 2em; margin-bottom: 2em; font-size: 0.875em; line-height: 1.71429; color: #524e48; font-family: 'Neue Montreal', ui-sans-serif, system-ui, -apple-system, 'system-ui', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; letter-spacing: 0.28px; background-color: #faf9f7;">
<thead style="box-sizing: border-box; border-width: 0px 0px 1px; border-style: solid; border-bottom-color: #bdbab7; border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; color: #231f1b; font-weight: 600;">
<tr style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;"><th style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: bottom; padding-right: 0.571429em; padding-bottom: 0.571429em; padding-left: 0px; width: 180px;">File/Directory</th><th style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: bottom; padding-right: 0px; padding-bottom: 0.571429em; padding-left: 0.571429em;">Description</th></tr>
</thead>
<tbody style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;">
<tr style="box-sizing: border-box; border-width: 0px 0px 1px; border-style: solid; border-bottom-color: #dad8d6; border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;">
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0.571429em 0.571429em 0px;">dagster_project/</td>
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0px 0.571429em 0.571429em;">A Python package that contains your new Dagster code.</td>
</tr>
<tr style="box-sizing: border-box; border-width: 0px 0px 1px; border-style: solid; border-bottom-color: #dad8d6; border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;">
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0.571429em 0.571429em 0px;">dagster_project_tests/</td>
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0px 0.571429em 0.571429em;">A Python package that contains tests for<code style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; font-family: 'Diatype Mono'; font-size: 14px; background: #f5f4f2; color: #231f1b; padding: 4px 6px; border-radius: 4px; overflow-wrap: break-word;">dagster_project</code>.</td>
</tr>
<tr style="box-sizing: border-box; border-width: 0px 0px 1px; border-style: solid; border-bottom-color: #dad8d6; border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;">
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0.571429em 0.571429em 0px;">README.md</td>
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0px 0.571429em 0.571429em;">A description and starter guide for your new Dagster project.</td>
</tr>
<tr style="box-sizing: border-box; border-width: 0px 0px 1px; border-style: solid; border-bottom-color: #dad8d6; border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;">
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0.571429em 0.571429em 0px;">pyproject.toml</td>
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0px 0.571429em 0.571429em;">A file that specifies package core metadata in a static, tool-agnostic way.<br style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;" /><br style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;" />This file includes a&nbsp;<code style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; font-family: 'Diatype Mono'; font-size: 14px; background: #f5f4f2; color: #231f1b; padding: 4px 6px; border-radius: 4px; overflow-wrap: break-word;">tool.dagster</code>&nbsp;section which references the Python package with your Dagster definitions defined and discoverable at the top level. This allows you to use the<code style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; font-family: 'Diatype Mono'; font-size: 14px; background: #f5f4f2; color: #231f1b; padding: 4px 6px; border-radius: 4px; overflow-wrap: break-word;">dagster dev</code>&nbsp;command to load your Dagster code without any parameters. Refer to the&nbsp;<a style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; color: #4f43dd; text-decoration-line: none; transition: all 0.3s ease 0s; overflow-wrap: break-word;" href="https://docs.dagster.io/concepts/code-locations">Code locations documentation</a>&nbsp;to learn more.<br style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;" /><br style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;" /><span style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; color: #231f1b;">Note:</span>&nbsp;<code style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; font-family: 'Diatype Mono'; font-size: 14px; background: #f5f4f2; color: #231f1b; padding: 4px 6px; border-radius: 4px; overflow-wrap: break-word;">pyproject.toml</code>&nbsp;was introduced in&nbsp;<a style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; color: #4f43dd; text-decoration-line: none; transition: all 0.3s ease 0s; overflow-wrap: break-word;" href="https://peps.python.org/pep-0518/https://peps.python.org/pep-0518/">PEP-518</a>&nbsp;and meant to replace&nbsp;<code style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; font-family: 'Diatype Mono'; font-size: 14px; background: #f5f4f2; color: #231f1b; padding: 4px 6px; border-radius: 4px; overflow-wrap: break-word;">setup.py</code>, but we may still include a&nbsp;<code style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; font-family: 'Diatype Mono'; font-size: 14px; background: #f5f4f2; color: #231f1b; padding: 4px 6px; border-radius: 4px; overflow-wrap: break-word;">setup.py</code>&nbsp;for compatibility with tools that do not use this spec.</td>
</tr>
<tr style="box-sizing: border-box; border-width: 0px 0px 1px; border-style: solid; border-bottom-color: #dad8d6; border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;">
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0.571429em 0.571429em 0px;">setup.py</td>
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0px 0.571429em 0.571429em;">A build script with Python package dependencies for your new project as a package.</td>
</tr>
<tr style="box-sizing: border-box; border-width: 0px; border-style: solid; border-bottom-color: #dad8d6; border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000;">
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0.571429em 0.571429em 0px;">setup.cfg</td>
<td style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; vertical-align: top; padding: 0.571429em 0px 0.571429em 0.571429em;">An ini file that contains option defaults for&nbsp;<code style="box-sizing: border-box; border-width: 0px; border-style: solid; border-color: rgba(218,216,214,var(--tw-border-opacity)); border-image: initial; --tw-border-opacity: 1; --tw-shadow: 0 0 #0000; --tw-ring-inset: var(--tw-empty, ); --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: rgba(59,130,246,0.5); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; font-family: 'Diatype Mono'; font-size: 14px; background: #f5f4f2; color: #231f1b; padding: 4px 6px; border-radius: 4px; overflow-wrap: break-word;">setup.py</code>&nbsp;commands.</td>
</tr>
</tbody>
</table>
<p>2) In that directory we save our sales csv file as:&nbsp;</p>
<p style="padding-left: 30px;">1973_topps_gossage_sales.csv</p>
<p>3) In that directory, create a file called python_assets.py:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre>from dagster import asset # import the `dagster` library

# python libraries we need for these assets
import numpy as np
import psycopg2
import psycopg2.extras as extras
import pandas as pd

# get sales from a csv file

@asset
def get_sales():
    csv_file_path = './1973_topps_gossage_sales.csv'
    df = pd.read_csv(csv_file_path)
    return df

# write sales to postgres table, calling the dataframe from get_sales
@asset
def write_sales(get_sales):
    conn = psycopg2.connect(
        database="demo_db",
        user='root',
        password='root',
        host='localhost',
        port='5432',
        options="-c search_path=dbo,public"
    )

    table = 'sales'
    tuples = [tuple(x) for x in get_sales.to_numpy()]

    cols = ','.join(list(get_sales.columns))
    query = "INSERT INTO %s(%s) VALUES %%s" % (table, cols)
    cursor = conn.cursor()
    try:
        extras.execute_values(cursor, query, tuples)
        conn.commit()
    except (Exception, psycopg2.DatabaseError) as error:
        print("Error: %s" % error)
        conn.rollback()
        cursor.close()
        return 1
    print("the dataframe is inserted")
    cursor.close() 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In the above code, we have functions preceded by the <strong>@asset</strong> decorator. This tells Dagster to identify them as software-defined assets that can be materialized.&nbsp;</p>
<p>The <strong>get_sales</strong> asset will read the csv file and populate the dataframe. The&nbsp;<strong>write_sales</strong> asset writes the contents of dataframe to our Postgres table. Notice the&nbsp;<strong>write_sales(<span style="color: #ff0000;">get_sales</span>)</strong>&nbsp;signature, that is how Dagster can recognize that&nbsp;<strong>get_sales</strong>&nbsp;is a dependency for&nbsp;<strong>write_sales</strong>.</p>
<p>PLEASE NOTE: We would never want to hard code database credentials in our python code, below is how you can use environment variables to make it more secure:&nbsp;&nbsp;<br /><span style="color: #0000ee; text-decoration-line: underline;">https://docs.dagster.io/guides/dagster/using-environment-variables-and-secrets</span>&nbsp;</p>
<p>4) We can now run the asset pipeline in the Dagster dashboard. You can type the following on the command line to launch the dagit dashboard:</p>
<p style="padding-left: 30px;">dagster dev -f python_assets.py</p>
<p>The you can visit the following address in your browser to view the dashboard:</p>
<p>http://127.0.0.1:3000/assets</p>

<p><img src="/assets/images/dagster_fun_1.png" alt="" /></p>

<p><br />4) Select the checkboxes in front of both assets and click the "Materialize selected" button. This will execute the assets in the correct order.&nbsp;</p>
<p>The screen below show the successful materialization of the assets:&nbsp;</p>

<p><img src="/assets/images/dagster_fun_2.png" alt="" /></p>

<p><br />5) We can log into Postgres (via pgadmin) and see our records written into the <strong>public.sales</strong> table:</p>

<p><img src="/assets/images/dagster_fun_3.png" alt="" /></p>

<h3><br />Running Dagster with Singer</h3>
<p><a href="https://www.singer.io/" target="_blank">Singer</a> is an open-source ETL tool from Stitch that lets you write scripts to move data from your sources to their destinations. Singer has two types of scripts&mdash;taps and targets.</p>
<ul>
<li>A tap is a script, or a piece of code, that connects to your data sources and outputs the data in JSON format.<br /><br /></li>
<li>A target script pipes these data streams from input sources and store them in your data destinations.&nbsp;</li>
</ul>
<p>1) In order to migrate our dagster flow to use singer, we will need a tap to read our csv and a target to write to postgres. We can install them into python virtual environments with the below commands:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>python -m venv tap-csv-venv
source tap-csv-venv/bin/activate
pip3 install git+https://github.com/MeltanoLabs/tap-csv.git
alias tap-csv="tap-csv-venv/bin/tap-csv"
deactivate

python -m venv target-postgres-venv
source target-postgres-venv/bin/activate
pip3 install git+https://github.com/datamill-co/target-postgres.git
alias target-postgres="target-postgres-venv/bin/target-postgres"
deactivate
</pre></td></tr></tbody></table></code></pre></div></div>

<p>2) Configure the tap-csv (docs at <a href="https://github.com/MeltanoLabs/tap-csv" target="_blank">https://github.com/MeltanoLabs/tap-csv</a>):</p>
<p>- Create a file singer/config.json with this content:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>{
    "csv_files_definition": "./singer/files_def.json"
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>- Create a file singer/files_def.json with this content:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>[
    {   "entity" : "sales",
        "path" : "1973_topps_gossage_sales.csv",
        "keys" : ["TransactionID"]
    }
]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You can test that the tap will read in your file and convert it to json:</p>
<p style="padding-left: 30px;"><strong>tap-csv --config singer/config.json</strong></p>
<p style="padding-left: 30px;">2023-04-03 05:23:13,706 | INFO&nbsp; &nbsp; &nbsp;| tap-csv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Beginning full_table sync of 'sales'...<br />2023-04-03 05:23:13,706 | INFO&nbsp; &nbsp; &nbsp;| tap-csv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Tap has custom mapper. Using 1 provided map(s).<br />{"type": "SCHEMA", "stream": "sales", "schema": {"properties": {"TransactionID": {"type": ["string", "null"]}, "Seller": {"type": ["string", "null"]}, "Date": {"type": ["string", "null"]}, "Value": {"type": ["string", "null"]}, "Title": {"type": ["string", "null"]}, "Identifier": {"type": ["string", "null"]}, "Condition": {"type": ["string", "null"]}, "RetailValue": {"type": ["string", "null"]}, "ItemValue": {"type": ["string", "null"]}}, "type": "object"}, "key_properties": ["TransactionID"]}<br />{"type": "RECORD", "stream": "sales", "record": {"TransactionID": "8094231", "Seller": "comicards990", "Date": "2023-04-12", "Value": "14.59", "Title": "1973 Topps Rich \"Goose\" Gossage Rookie White Sox HOF #174", "Identifier": "134520441986", "Condition": "Ungraded", "RetailValue": "6.00", "ItemValue": "8.73"}, "time_extracted": "2023-04-03T09:23:13.706647+00:00"}<br />{"type": "STATE", "value": {"bookmarks": {"sales": {"starting_replication_value": null}}}}<br />{"type": "RECORD", "stream": "sales", "record": {"TransactionID": "8094232", "Seller": "916lukey31", "Date": "2023-04-11", "Value": "10.95", "Title": "1973 Topps #174 Rich Gossage RC HOF Vg-Ex *Free Shipping*", "Identifier": "275699466365", "Condition": "Ungraded", "RetailValue": "6.00", "ItemValue": "8.73"}, "time_extracted": "2023-04-03T09:23:13.706848+00:00"}<br />{"type": "RECORD", "stream": "sales", "record": {"TransactionID": "8094233", "Seller": "jayjay5119", "Date": "2023-04-11", "Value": "6.50", "Title": "1973 Topps Baseball! Rich Gossage rookie card! Card174! Chicago White Sox!", "Identifier": "195695255305", "Condition": "Ungraded", "RetailValue": "6.00", "ItemValue": "8.73"}, "time_extracted": "2023-04-03T09:23:13.707571+00:00"}<br />2023-04-03 05:23:13,707 | INFO&nbsp; &nbsp; &nbsp;| singer_sdk.metrics&nbsp; &nbsp;| INFO METRIC: {"metric_type": "timer", "metric": "sync_duration", "value": 0.0012621879577636719, "tags": {"stream": "sales", "context": {}, "status": "succeeded"}}<br />2023-04-03 05:23:13,708 | INFO&nbsp; &nbsp; &nbsp;| singer_sdk.metrics&nbsp; &nbsp;| INFO METRIC: {"metric_type": "counter", "metric": "record_count", "value": 3, "tags": {"stream": "sales", "context": {}}}<br />{"type": "STATE", "value": {"bookmarks": {"sales": {}}}}<br />{"type": "STATE", "value": {"bookmarks": {"sales": {}}}}</p>
<p>2) Configure the taraget-postgres (docs at&nbsp;<a href="https://github.com/datamill-co/target-postgres" target="_blank">https://github.com/datamill-co/target-postgres</a>):</p>

<p>- Create a file singer/target_postgres_config.json with this content:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>{
    "postgres_host": "localhost",
    "postgres_port": 5432,
    "postgres_database": "demo_db",
    "postgres_username": "root",
    "postgres_password": "root",
    "postgres_schema": "public"
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You can test that the tap and target will read in your file and upload it to postgres:</p>
<p style="padding-left: 30px;"><strong>tap-csv --config singer/config.json | target-postgres --config singer/target_postgres_config.json&nbsp;<br /></strong></p>
<p style="padding-left: 30px;">INFO PostgresTarget created with established connection: `user=root password=xxx dbname=demo_db host=localhost port=5432 application_name=target-postgres`, PostgreSQL schema: `public`</p>
<p style="padding-left: 30px;">INFO Sending version information to singer.io. To disable sending anonymous usage data, set the config parameter "disable_collection" to true</p>
<p style="padding-left: 30px;">2023-04-03 13:09:44,466 | INFO&nbsp; &nbsp; &nbsp;| tap-csv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Beginning full_table sync of 'sales'...<br />2023-04-03 13:09:44,467 | INFO&nbsp; &nbsp; &nbsp;| tap-csv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Tap has custom mapper. Using 1 provided map(s).<br />2023-04-03 13:09:44,467 | INFO&nbsp; &nbsp; &nbsp;| singer_sdk.metrics&nbsp; &nbsp;| INFO METRIC: {"metric_type": "timer", "metric": "sync_duration", "value": 0.000537872314453125, "tags": {"stream": "sales", "context": {}, "status": "succeeded"}}<br />2023-04-03 13:09:44,467 | INFO&nbsp; &nbsp; &nbsp;| singer_sdk.metrics&nbsp; &nbsp;| INFO METRIC: {"metric_type": "counter", "metric": "record_count", "value": 3, "tags": {"stream": "sales", "context": {}}}<br />INFO Mapping: test to None<br />INFO Mapping: sales to ['sales']<br />INFO Mapping: tp_sales_transactionid__sdc_sequence_idx to None<br />INFO Stream sales (sales) with max_version None targetting None<br />INFO Root table name sales<br />INFO Writing batch with 3 records for `sales` with `key_properties`: `['TransactionID']`<br />INFO Writing table batch schema for `('sales',)`...<br />INFO METRIC: {"type": "timer", "metric": "job_duration", "value": 0.048573970794677734, "tags": {"job_type": "upsert_table_schema", "path": ["sales"], "database": "demo_db", "schema": "public", "table": "sales", "status": "succeeded"}}<br />INFO Writing table batch with 3 rows for `('sales',)`...<br />INFO METRIC: {"type": "counter", "metric": "record_count", "value": 3, "tags": {"count_type": "table_rows_persisted", "path": ["sales"], "database": "demo_db", "schema": "public", "table": "sales"}}<br />INFO METRIC: {"type": "timer", "metric": "job_duration", "value": 0.10874700546264648, "tags": {"job_type": "table", "path": ["sales"], "database": "demo_db", "schema": "public", "table": "sales", "status": "succeeded"}}<br />INFO METRIC: {"type": "counter", "metric": "record_count", "value": 3, "tags": {"count_type": "batch_rows_persisted", "path": ["sales"], "database": "demo_db", "schema": "public"}}<br />INFO METRIC: {"type": "timer", "metric": "job_duration", "value": 0.10944700241088867, "tags": {"job_type": "batch", "path": ["sales"], "database": "demo_db", "schema": "public", "status": "succeeded"}}</p>
<p><strong><span style="text-decoration: underline;">Some things to take note of:</span><br /></strong></p>
<p>- We defined the entity = "sales" in the tap.&nbsp; So that dictates the table_name for the target.</p>
<p>- We see in the output <strong>"job_type": "upsert_table_schema"</strong>, this means that write to postgres will do an upsert of the record based on the keys we defined in tap ("keys" : ["TransactionID"]).</p>
<p>3)&nbsp;In that directory, create a file called python_assets.py:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre># import the `dagster` library
from dagster import asset

# python libraries we need for these assets
import subprocess

# get sales from a csv file and write to postgres via singer tap and target
@asset
def get_and_write_sales_with_singer():
    ps = subprocess.Popen(['~/dagster/dagster-project/tap-csv-venv/bin/tap-csv', '--config', 'singer/config.json'],
    stdout=subprocess.PIPE) output = subprocess.run(['~/dagster/dagster-project/target-postgres-venv/bin/target-postgres', '--config', 'singer/target_postgres_config.json'], stdin=ps.stdout)
    ps.wait() print(output.stdout)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>4) We can now run the asset pipeline in the Dagster dashboard. You can type the following on the command line to launch the dagit dashboard:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>dagster dev -f singer_assets.py
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The you can visit the following address in your browser to view the dashboard:</p>
<p>http://127.0.0.1:3000/assets</p>

<p><img src="/assets/images/dagster_fun_4.png" alt="" /></p>

<p><br />5) Select the checkboxes in front of both assets and click the "Materialize selected" button. This will execute the assets in the correct order.&nbsp;</p>
<p>The screen below show the successful materialization of the assets:&nbsp;</p>

<p><img src="/assets/images/dagster_fun_5.png" alt="" /></p>

<p>&nbsp;<br />6) We can log into Postgres (via pgadmin) and see our records written into the&nbsp;<strong>public.sales</strong>&nbsp;table:</p>

<p><img src="/assets/images/dagster_fun_6.png" alt="" /></p>

<h3><br />Running Dagster with Meltano</h3>

<p><a href="https://meltano.com/" target="_blank">Meltano</a> is an open source tool which can be used to extract from data sources and load it to destinations like your data warehouse. It uses extractors and loaders written in the Singer open source standard.</p>

<p>1) In order to migrate our dagster flow to use meltano, we will need to install meltano:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip3 install meltano
</pre></td></tr></tbody></table></code></pre></div></div>

<p>2) Configure a new meltano project and switch into the directory:&nbsp;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>meltano init meltano
cd meltano
</pre></td></tr></tbody></table></code></pre></div></div>

<p>3) We need to install the tap and target:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>meltano add extractor tap-csv
meltano add loader target-postgres --variant&amp;nbsp;datamill-co
</pre></td></tr></tbody></table></code></pre></div></div>

<p>4) Adding a job that include the tap and target:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>meltano job add demo_job --tasks "tap-csv target-postgres"
</pre></td></tr></tbody></table></code></pre></div></div>

<p>4) Configure the following in meltano.yml (it should look very similar to the singer configuration from the Singer section):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>version: 1
default_environment: dev
project_id: fb9afb3c-5560-406e-b977-d86eef949779
environments:
- name: dev
- name: staging
- name: prod
plugins:
extractors:
- name: tap-csv
    variant: meltanolabs
    pip_url: git+https://github.com/MeltanoLabs/tap-csv.git
    config:
    files:
        - entity: sales
        file: ../1973_topps_gossage_sales.csv
        keys:
            - TransactionID
loaders:
- name: target-postgres
    variant: datamill-co
    pip_url: git+https://github.com/datamill-co/target-postgres.git
    config:
    host: localhost
    port: 5432
    user: root
    password: root
    dbname: demo_db
    default_target_schema: public
jobs:
- name: demo_job
tasks:
- tap-csv target-postgres
</pre></td></tr></tbody></table></code></pre></div></div>

<p>5) Run meltano on the command line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>meltano run demo_job
</pre></td></tr></tbody></table></code></pre></div></div>

<p style="padding-left: 30px;">2023-04-03T18:06:17.336263Z [info&nbsp; &nbsp; &nbsp;] Environment 'dev' is active<br />2023-04-03T18:06:19.212684Z [info&nbsp; &nbsp; &nbsp;] INFO Starting sync&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cmd_type=elb consumer=False name=tap-csv producer=True stdio=stderr string_id=tap-csv<br />2023-04-03T18:06:19.212939Z [info&nbsp; &nbsp; &nbsp;] INFO Syncing entity 'sales' from file: '../1973_topps_gossage_sales.csv' cmd_type=elb consumer=False name=tap-csv producer=True stdio=stderr string_id=tap-csv<br />2023-04-03T18:06:19.213097Z [info&nbsp; &nbsp; &nbsp;] INFO Sync completed&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmd_type=elb consumer=False name=tap-csv producer=True stdio=stderr string_id=tap-csv<br />2023-04-03T18:06:19.577999Z [info&nbsp; &nbsp; &nbsp;] time=2023-04-03 14:06:19 name=target_postgres level=INFO message=Table '"sales"' exists cmd_type=elb consumer=True name=target-postgres producer=False stdio=stderr string_id=target-postgres<br />2023-04-03T18:06:19.711365Z [info&nbsp; &nbsp; &nbsp;] time=2023-04-03 14:06:19 name=target_postgres level=INFO message=Loading 3 rows into 'public."sales"' cmd_type=elb consumer=True name=target-postgres producer=False stdio=stderr string_id=target-postgres<br />2023-04-03T18:06:19.840375Z [info&nbsp; &nbsp; &nbsp;] time=2023-04-03 14:06:19 name=target_postgres level=INFO message=Loading into public."sales": {"inserts": 0, "updates": 3, "size_bytes": 452} cmd_type=elb consumer=True name=target-postgres producer=False stdio=stderr string_id=target-postgres<br />2023-04-03T18:06:19.862895Z [info&nbsp; &nbsp; &nbsp;] Incremental state has been updated at 2023-04-03 18:06:19.862840.<br />2023-04-03T18:06:19.871775Z [info&nbsp; &nbsp; &nbsp;] Block run completed.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;block_type=ExtractLoadBlocks err=None set_number=0 success=True</p>

<p>6) Install the Dagster-Meltano library</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>cd ../
pip3 install dagster-meltano
</pre></td></tr></tbody></table></code></pre></div></div>

<p>7) In that directory, create a file called meltano_assets.py:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>from dagster import Definitions, job
from dagster_meltano import meltano_resource, meltano_run_op 

@job(resource_defs={"meltano": meltano_resource})
def run_job():
tap_done = meltano_run_op("demo_job")() 

# alternatively we could run this
# tap_done = meltano_run_op("tap-csv target-postgres")()

defs = Definitions(jobs=[run_job])
</pre></td></tr></tbody></table></code></pre></div></div>

<p>8) We can now run the asset pipeline in the Dagster dashboard. You can type the following on the command line to launch the dagit dashboard:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>dagster dev -f meltano_assets.py
</pre></td></tr></tbody></table></code></pre></div></div>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2023-04-04">04 Apr 2023</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <!--<div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                </ul>
            </div>-->
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#dagster">#dagster</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#data-engineering">#data engineering</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#meltano">#meltano</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#orchestration">#orchestration</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#python">#python</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#singer">#singer</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#workflow">#workflow</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="/snowflake-setup-with-terraform/" > &laquo; My Snowflake Set up with Terraform</a>



            
            
            <a class="next d-block col-md-6 text-lg-right" href="/optimizing-snowfalke/">Optimizing spend in Snowflake &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


    
</div>

-<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Popular Tags <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#sportscarddatabase">SportsCardDatabase  (4)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#analysis">analysis  (9)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#data">data  (3)</a>
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#data-engineering">data engineering  (7)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#dreams">dreams  (3)</a>
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#ebay">eBay  (3)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#favorites">favorites  (7)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#python">python  (4)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#singer">singer  (3)</a>
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#snowflake">snowflake  (4)</a>
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#sportscollectors">sportscollectors  (5)</a>
            
            
            
            
            
            
            
            
            
            
            <a class="mt-1 mb-1" href="/tags#strategy">strategy  (3)</a>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
		</div>
	</div>
</div>


<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 JayGrossman.com 
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//.disqus.com/count.js"></script>


</body>
</html>
